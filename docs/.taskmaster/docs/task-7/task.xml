<?xml version="1.0" encoding="UTF-8"?>
<prompt>
    <role>You are a senior Rust test engineer specializing in integration testing, API testing, and test-driven development.</role>

    <task>
        <id>7</id>
        <title>Integration Tests</title>
        <description>Create comprehensive integration tests for the entire application. Test authentication (JWT, passwords), API endpoints (health check, products), shopping cart operations, and full end-to-end user workflows. Validate that all modules integrate correctly and the system functions as a cohesive whole.</description>
        <priority>high</priority>
        <status>pending</status>
        <dependencies>2,5,6</dependencies>
        <level>2</level>
        <estimated_time>60 minutes</estimated_time>
    </task>

    <technical_specifications>
        <spec>Use Rust built-in testing with #[test] and #[actix_web::test] attributes</spec>
        <spec>Use Actix-web test utilities (test::init_service, test::TestRequest, test::call_service)</spec>
        <spec>Test authentication: JWT creation/validation, password hashing/verification</spec>
        <spec>Test API endpoints: health check, product routes</spec>
        <spec>Test integration: full user flow from authentication to cart operations</spec>
        <spec>Verify HTTP status codes (200, 400, 401, 404)</spec>
        <spec>Validate JSON response structures and data correctness</spec>
        <spec>Test with in-memory services (no database needed)</spec>
    </technical_specifications>

    <implementation_details>
        <overview>Create three test files covering authentication, API endpoints, and full integration. Tests validate all previous tasks work together correctly. Level 2 task - final system validation.</overview>

        <step number="1">
            <action>Create tests/auth_tests.rs</action>
            <details>
                Test JWT lifecycle, password hashing/verification, User serialization.
                Use #[test] attribute for unit tests.
            </details>
        </step>

        <step number="2">
            <action>Create tests/api_tests.rs</action>
            <details>
                Test health check endpoint, product routes.
                Use #[actix_web::test] attribute.
                Initialize test app with services.
                Use TestRequest to make HTTP calls.
            </details>
        </step>

        <step number="3">
            <action>Create tests/integration_tests.rs</action>
            <details>
                Test full user flow: create product, create token, add to cart, get cart.
                Verify multi-module integration.
                Assert correct data in responses.
            </details>
        </step>

        <step number="4">
            <action>Update src/main.rs</action>
            <details>
                Make modules public: pub mod api, pub mod schema, pub mod auth, pub mod catalog, pub mod cart.
            </details>
        </step>

        <step number="5">
            <action>Run tests and verify</action>
            <details>
                cargo test
                Verify all tests pass.
            </details>
        </step>
    </implementation_details>

    <acceptance_criteria>
        <criterion>Files tests/integration_tests.rs, tests/api_tests.rs, tests/auth_tests.rs created</criterion>
        <criterion>src/main.rs updated with public module declarations</criterion>
        <criterion>Authentication tests cover JWT and password operations</criterion>
        <criterion>API tests cover health check and product routes</criterion>
        <criterion>Integration test covers full user flow (create product → add to cart → get cart)</criterion>
        <criterion>All tests compile without errors</criterion>
        <criterion>cargo test passes all tests</criterion>
        <criterion>Tests verify HTTP status codes, JSON structures, and data correctness</criterion>
    </acceptance_criteria>

    <test_strategy>
        <validation>Run cargo test and verify all tests pass. Test individual files. Check test coverage.</validation>
    </test_strategy>

    <instructions>
        Create comprehensive tests covering authentication, API endpoints, and full integration. Use Actix-web test utilities. Verify all modules work together. Ensure all tests pass.
    </instructions>

    <context>
        <project>
            <name>Parallel Task Execution Test</name>
            <repository>https://github.com/5dlabs/cto-parallel-test</repository>
        </project>
        <execution_context>
            <level>2</level>
            <depends_on>Tasks 2, 5, 6</depends_on>
            <purpose>Final validation of complete system</purpose>
        </execution_context>
    </context>
</prompt>
