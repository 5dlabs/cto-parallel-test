Database Setup and Diesel Configuration

Overview
- Backend uses Diesel ORM with PostgreSQL.
- Connection string is supplied via the DATABASE_URL environment variable (dotenvy supported for local).
- Migrations live in the migrations/ directory and generate src/schema.rs.

Prerequisites
- PostgreSQL running and reachable from your environment
- Rust toolchain installed
- Diesel CLI installed for migration management:
  - cargo install diesel_cli --no-default-features --features postgres

Environment Variables
- DATABASE_URL: Required. Format: postgresql://<username>:<password>@<host>:<port>/<database>
- Optional pool tuning (sane defaults if unset):
  - DB_POOL_MAX_SIZE (u32, default 15)
  - DB_POOL_MIN_IDLE (u32, optional)
  - DB_POOL_CONNECTION_TIMEOUT_SECS (u64, default 30)
  - DB_POOL_MAX_LIFETIME_SECS (u64, optional)
  - DB_POOL_IDLE_TIMEOUT_SECS (u64, optional)
  - DB_POOL_TEST_ON_CHECK_OUT (bool: true/false, optional)

Local .env Example
- Copy .env.example to .env and set a real connection string. Never commit .env.

 .env.example contains:
  DATABASE_URL=
  # Optionally: DB_POOL_MAX_SIZE=15, DB_POOL_MIN_IDLE=5, DB_POOL_CONNECTION_TIMEOUT_SECS=30

Initialize Diesel
1) Ensure DATABASE_URL is set in your environment or .env
2) Run initial setup (creates the database if it does not exist):
   diesel setup

Migrations
- Create migrations (already present in this repo):
  - users, products, carts, cart_items with proper FKs and cascades
- To apply:
  diesel migration run
- To verify up/down correctness:
  diesel migration redo

Schema Generation
- src/schema.rs is generated by Diesel (see diesel.toml for target path)
- Do not hand-edit schema.rs; regenerate via migrations when the schema changes

Security Notes
- Never hardcode credentials in code; use environment variables or secrets management.
- Use NUMERIC for price fields for financial accuracy (mapped to BigDecimal in Rust).
- Foreign keys include ON DELETE CASCADE where appropriate.
- The password_hash on User is marked to skip serialization.

Validation and Quality Gates
- cargo fmt --all -- --check
- cargo clippy --workspace --all-targets --all-features -- -D warnings -W clippy::pedantic
- cargo test --workspace --all-features
- cargo audit (ensure no known vulnerable crates)

Troubleshooting
- "DATABASE_URL must be set": ensure .env or environment is populated.
- Connection refused: verify Postgres service, host/port, and credentials.
- relation already exists: run diesel migration revert or diesel migration redo.

