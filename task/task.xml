<prompt>
    <role>You are a senior Rust backend developer specializing in service layer architecture, thread-safe concurrent systems, and e-commerce product management. You have extensive experience building scalable catalog systems.</role>

    <task>
        <id>4</id>
        <title>Product Catalog Module</title>
        <description>Implement a thread-safe product catalog system with CRUD operations, inventory management, and flexible filtering capabilities using in-memory storage with rust_decimal for financial precision.</description>
        <priority>medium</priority>
        <status>pending</status>
        <dependencies></dependencies>
        <estimated_time>40 minutes</estimated_time>
        <level>0</level>
    </task>

    <technical_specifications>
        <spec>Use rust_decimal version 1.30 with serde feature for price handling</spec>
        <spec>Implement thread-safe storage with Arc and Mutex</spec>
        <spec>Auto-increment product IDs starting from 1</spec>
        <spec>Support case-insensitive name filtering with substring matching</spec>
        <spec>Support price range filtering (min/max)</spec>
        <spec>Support stock status filtering (in stock vs out of stock)</spec>
        <spec>Implement Clone trait for Product model</spec>
        <spec>Use Vec for in-memory storage (database integration is separate)</spec>
        <spec>Provide Default trait implementation for ProductService</spec>
    </technical_specifications>

    <implementation_details>
## Product Catalog Structure

### Models (models.rs)
- **Product**: Full product entity with ID
- **NewProduct**: Product creation DTO without ID
- **ProductFilter**: Search/filter criteria struct

### Service (service.rs)
- **ProductService**: Business logic layer
- Thread-safe storage: `Arc<Mutex<Vec<Product>>>`
- ID management: `Arc<Mutex<i32>>`

## Key Implementation Points

### Thread Safety
- Use Arc for shared ownership across threads
- Use Mutex for interior mutability
- Clone products when returning to avoid exposing internal state
- Lock only for duration of operation

### Filtering Logic
- Name: case-insensitive substring matching
- Price: inclusive range (min <= price <= max)
- Stock: inventory_count > 0 for in_stock=true
- Combine filters with AND logic
- Use map_or for optional filters

### Decimal Precision
- Use rust_decimal::Decimal for monetary values
- Preserves exact decimal representation
- Supports arithmetic operations
- Serializes to JSON as string or number

## Reference Resources
- Architecture: .taskmaster/docs/architecture.md (lines 234-263)
    </implementation_details>

    <acceptance_criteria>
        <criterion>rust_decimal dependency added to Cargo.toml</criterion>
        <criterion>Product model with Decimal price field</criterion>
        <criterion>Thread-safe ProductService implementation</criterion>
        <criterion>Auto-incrementing IDs work correctly</criterion>
        <criterion>CRUD operations implemented</criterion>
        <criterion>Filtering by name, price, and stock works</criterion>
        <criterion>Concurrent access is safe</criterion>
        <criterion>cargo test passes all product tests</criterion>
    </acceptance_criteria>

    <test_strategy>
## Test Commands
```bash
cargo test catalog
cargo test --lib catalog::
```

## Key Tests
1. Product creation with auto-increment IDs
2. Get all products
3. Get product by ID
4. Update inventory
5. Filter by name (case-insensitive)
6. Filter by price range
7. Filter by stock status
8. Combined filters
9. Concurrent product creation
10. Decimal precision maintained
    </test_strategy>

    <instructions>
Implement product catalog with focus on:
1. Thread safety using Arc<Mutex>
2. Decimal precision for prices
3. Flexible filtering
4. Clean separation of models and service
5. Comprehensive testing

Common pitfalls:
- Don't use f64 for prices (use Decimal)
- Don't forget to lock/unlock mutex
- Don't expose internal mutable state
- Don't forget Clone derive on Product
- Test concurrent access
    </instructions>
</prompt>
