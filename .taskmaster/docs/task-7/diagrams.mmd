```mermaid
graph TB
    subgraph "Integration Tests Architecture"
        IntTests[tests/integration_tests.rs<br/>System-wide Tests]
        APITests[tests/api_tests.rs<br/>API Endpoint Tests]
        AuthTests[tests/auth_tests.rs<br/>Authentication Tests]
    end

    subgraph "Integration Tests"
        HealthCheck[test_health_check&#40;&#41;<br/>Verify /api/health<br/>200 OK + JSON]
        UserFlow[test_full_user_flow&#40;&#41;<br/>Product → JWT → Cart<br/>End-to-end Integration]

        IntTests --> HealthCheck
        IntTests --> UserFlow
    end

    subgraph "API Tests"
        ProdRoutes[test_product_routes&#40;&#41;<br/>GET /api/products<br/>GET /api/products/:id<br/>Status + Data]

        APITests --> ProdRoutes
    end

    subgraph "Authentication Tests"
        JWTTest[test_jwt_creation_and_validation&#40;&#41;<br/>create_token → validate_token<br/>Claims verification]
        PassTest[test_password_hashing_and_verification&#40;&#41;<br/>Hash → Verify correct/wrong<br/>Security validation]

        AuthTests --> JWTTest
        AuthTests --> PassTest
    end

    subgraph "System Components Tested"
        Task2[Task 2: API Endpoints<br/>configure_routes<br/>Health check]
        Task3[Task 3: Authentication<br/>JWT functions<br/>User model]
        Task4[Task 4: Product Catalog<br/>ProductService<br/>Product models]
        Task5[Task 5: Shopping Cart<br/>CartService<br/>Cart endpoints]
        Task6[Task 6: Frontend<br/>Structure verification]

        HealthCheck -.->|tests| Task2
        UserFlow -.->|tests| Task2
        UserFlow -.->|tests| Task3
        UserFlow -.->|tests| Task4
        UserFlow -.->|tests| Task5
        ProdRoutes -.->|tests| Task2
        ProdRoutes -.->|tests| Task4
        JWTTest -.->|tests| Task3
        PassTest -.->|tests| Task3
    end

    subgraph "Main Application Update"
        MainRS[src/main.rs<br/>Service Initialization]
        ProdSvc[ProductService::new&#40;&#41;<br/>web::Data]
        CartSvc[CartService::new&#40;&#41;<br/>web::Data]
        AppConfig[App::new&#40;&#41;<br/>.app_data&#40;services&#41;<br/>.configure&#40;routes&#41;]

        MainRS --> ProdSvc
        MainRS --> CartSvc
        ProdSvc --> AppConfig
        CartSvc --> AppConfig
    end

    style IntTests fill:#e1f5ff
    style APITests fill:#e1f5ff
    style AuthTests fill:#e1f5ff
    style HealthCheck fill:#c8e6c9
    style UserFlow fill:#c8e6c9
    style ProdRoutes fill:#c8e6c9
    style JWTTest fill:#c8e6c9
    style PassTest fill:#c8e6c9
    style Task2 fill:#ffebee
    style Task3 fill:#ffebee
    style Task4 fill:#ffebee
    style Task5 fill:#ffebee
    style Task6 fill:#ffebee
    style MainRS fill:#fff3e0
```

```mermaid
sequenceDiagram
    participant Test as Integration Test
    participant App as Test App Instance
    participant Routes as API Routes
    participant Auth as JWT Auth
    participant ProdSvc as ProductService
    participant CartSvc as CartService

    Note over Test,CartSvc: Full User Flow Test

    Test->>Test: Create ProductService & CartService
    Test->>App: init_service with services
    App-->>Test: Test app ready

    Test->>ProdSvc: create(NewProduct)
    ProdSvc-->>Test: Product (id=1)

    Test->>Auth: create_token("1")
    Auth-->>Test: JWT token

    Test->>App: POST /api/cart/add<br/>Auth: Bearer token<br/>Body: {product_id: 1, qty: 2}
    App->>Routes: Route to cart handler
    Routes->>Auth: validate_token(token)
    Auth-->>Routes: Claims (user_id=1)
    Routes->>ProdSvc: get_by_id(1)
    ProdSvc-->>Routes: Product
    Routes->>CartSvc: add_item(user_id, product, qty)
    CartSvc-->>Routes: Cart
    Routes-->>App: 200 OK + Cart JSON
    App-->>Test: Response

    Test->>Test: Assert status 200 OK

    Test->>App: GET /api/cart<br/>Auth: Bearer token
    App->>Routes: Route to cart handler
    Routes->>Auth: validate_token(token)
    Auth-->>Routes: Claims (user_id=1)
    Routes->>CartSvc: get_cart(user_id)
    CartSvc-->>Routes: Cart
    Routes-->>App: 200 OK + Cart JSON
    App-->>Test: Response

    Test->>Test: Parse Cart from body
    Test->>Test: Assert items.len() == 1
    Test->>Test: Assert item.product_id == 1
    Test->>Test: Assert item.quantity == 2
    Test->>Test: Test PASSED ✓
```

```mermaid
flowchart TD
    Start([Run cargo test]) --> CompileTests[Compile all test files]
    CompileTests --> CheckDeps{All dependencies<br/>available?}
    CheckDeps -->|No| DepError[Compilation Error<br/>Missing Task 2, 5, or 6]
    CheckDeps -->|Yes| CreateApps[Create test App instances]

    CreateApps --> RunHealth[Run test_health_check]
    RunHealth --> HealthReq[GET /api/health]
    HealthReq --> HealthCheck{Status 200 OK<br/>JSON correct?}
    HealthCheck -->|Yes| HealthPass[Health Check PASSED ✓]
    HealthCheck -->|No| HealthFail[Health Check FAILED ✗]

    HealthPass --> RunUserFlow[Run test_full_user_flow]
    RunUserFlow --> CreateProduct[Create test product]
    CreateProduct --> GenToken[Generate JWT token]
    GenToken --> AddToCart[POST /api/cart/add]
    AddToCart --> GetCart[GET /api/cart]
    GetCart --> VerifyCart{Cart contents<br/>correct?}
    VerifyCart -->|Yes| UserFlowPass[User Flow PASSED ✓]
    VerifyCart -->|No| UserFlowFail[User Flow FAILED ✗]

    UserFlowPass --> RunAPITests[Run test_product_routes]
    RunAPITests --> TestGetAll[GET /api/products]
    TestGetAll --> TestGetByID[GET /api/products/1]
    TestGetByID --> VerifyAPI{Responses<br/>correct?}
    VerifyAPI -->|Yes| APIPass[API Tests PASSED ✓]
    VerifyAPI -->|No| APIFail[API Tests FAILED ✗]

    APIPass --> RunJWT[Run test_jwt_creation_and_validation]
    RunJWT --> CreateJWT[create_token]
    CreateJWT --> ValidateJWT[validate_token]
    ValidateJWT --> CheckClaims{Claims<br/>correct?}
    CheckClaims -->|Yes| JWTPass[JWT Test PASSED ✓]
    CheckClaims -->|No| JWTFail[JWT Test FAILED ✗]

    JWTPass --> RunPassword[Run test_password_hashing_and_verification]
    RunPassword --> HashPass[Hash password]
    HashPass --> VerifyCorrect[Verify correct password]
    VerifyCorrect --> VerifyWrong[Verify wrong password fails]
    VerifyWrong --> CheckPass{Both checks<br/>pass?}
    CheckPass -->|Yes| PassPass[Password Test PASSED ✓]
    CheckPass -->|No| PassFail[Password Test FAILED ✗]

    PassPass --> AllPassed[All Tests Passed ✓<br/>5/5 tests ok]
    HealthFail --> SomeFailed[Some Tests Failed ✗]
    UserFlowFail --> SomeFailed
    APIFail --> SomeFailed
    JWTFail --> SomeFailed
    PassFail --> SomeFailed

    AllPassed --> Success[Task 7 Complete<br/>System Integration Verified]
    SomeFailed --> Failure[Task 7 Incomplete<br/>Fix Failures]

    style Start fill:#e3f2fd
    style HealthPass fill:#c8e6c9
    style UserFlowPass fill:#c8e6c9
    style APIPass fill:#c8e6c9
    style JWTPass fill:#c8e6c9
    style PassPass fill:#c8e6c9
    style AllPassed fill:#81c784
    style Success fill:#66bb6a
    style HealthFail fill:#ffcdd2
    style UserFlowFail fill:#ffcdd2
    style APIFail fill:#ffcdd2
    style JWTFail fill:#ffcdd2
    style PassFail fill:#ffcdd2
    style SomeFailed fill:#ef5350
    style Failure fill:#e53935
```

```mermaid
graph TB
    subgraph "Complete Task Dependency Tree"
        subgraph "Level 0 - Parallel Execution"
            Task1[Task 1: Database Schema<br/>30 min<br/>NO DEPENDENCIES]
            Task3[Task 3: User Auth<br/>45 min<br/>NO DEPENDENCIES]
            Task4[Task 4: Product Catalog<br/>40 min<br/>NO DEPENDENCIES]
            Task6[Task 6: Frontend<br/>35 min<br/>NO DEPENDENCIES]
        end

        subgraph "Level 1 - First Integration"
            Task2[Task 2: API Endpoints<br/>50 min<br/>DEPENDS: Task 1]
            Task5[Task 5: Shopping Cart API<br/>45 min<br/>DEPENDS: Tasks 3, 4]
        end

        subgraph "Level 2 - Final Integration"
            Task7[Task 7: Integration Tests<br/>60 min<br/>DEPENDS: Tasks 2, 5, 6]
        end

        Task1 -->|provides schema| Task2
        Task3 -->|provides auth| Task5
        Task4 -->|provides products| Task5
        Task2 -->|provides API routes| Task7
        Task5 -->|provides cart API| Task7
        Task6 -->|provides frontend| Task7
    end

    subgraph "Task 7 Validates Integration"
        T7[Task 7:<br/>Integration Tests]
        Tests[5 Test Functions]
        Coverage[Complete System<br/>Verification]

        T7 --> Tests
        Tests --> Coverage
    end

    subgraph "Test Coverage"
        C1[Task 2: Health check, API routes]
        C2[Task 3: JWT, passwords, User]
        C3[Task 4: ProductService, products]
        C4[Task 5: CartService, cart flow]
        C5[Task 6: Frontend structure]

        Task7 -.->|tests| C1
        Task7 -.->|tests| C2
        Task7 -.->|tests| C3
        Task7 -.->|tests| C4
        Task7 -.->|verifies| C5
    end

    subgraph "Expected Execution Timeline"
        Level0Time[Level 0: 45 min<br/>4 tasks parallel<br/>max&#40;30,45,40,35&#41; = 45]
        Level1Time[Level 1: 50 min<br/>2 tasks parallel<br/>max&#40;50,45&#41; = 50]
        Level2Time[Level 2: 60 min<br/>1 task<br/>60]
        TotalTime[Total: 155 min<br/>Theoretical speedup: 7/3 = 2.33x]

        Level0Time --> Level1Time
        Level1Time --> Level2Time
        Level2Time --> TotalTime
    end

    style Task7 fill:#ffd54f,stroke:#f57c00,stroke-width:4px
    style Task2 fill:#ffecb3,stroke:#f57c00,stroke-width:2px
    style Task5 fill:#ffecb3,stroke:#f57c00,stroke-width:2px
    style Task6 fill:#ffecb3,stroke:#f57c00,stroke-width:2px
    style T7 fill:#ffd54f,stroke:#f57c00,stroke-width:4px
    style Coverage fill:#c8e6c9

    classDef level0 fill:#e1f5fe
    classDef level1 fill:#fff3e0
    classDef level2 fill:#f3e5f5

    class Task1,Task3,Task4,Task6 level0
    class Task2,Task5 level1
    class Task7 level2
```

```mermaid
graph LR
    subgraph "Test Files and Their Coverage"
        direction TB

        IT[integration_tests.rs]
        HC[test_health_check<br/>Validates: API available<br/>Endpoint: /api/health<br/>Expected: 200 OK]
        UF[test_full_user_flow<br/>Validates: Complete e-commerce flow<br/>Steps: Product → Token → Cart<br/>Components: All services]

        AT[api_tests.rs]
        PR[test_product_routes<br/>Validates: Product endpoints<br/>Endpoints: GET /products, GET /products/:id<br/>Components: ProductService, Routes]

        AUT[auth_tests.rs]
        JWT[test_jwt_creation_and_validation<br/>Validates: Token security<br/>Functions: create_token, validate_token<br/>Component: JWT module]
        PW[test_password_hashing_and_verification<br/>Validates: Password security<br/>Functions: hash_password, verify_password<br/>Component: User model]

        IT --> HC
        IT --> UF
        AT --> PR
        AUT --> JWT
        AUT --> PW
    end

    subgraph "Coverage Matrix"
        direction LR

        M[Test Coverage Matrix]

        T2C[Task 2: ✓ Health check<br/>✓ Route config<br/>✓ API structure]
        T3C[Task 3: ✓ JWT creation<br/>✓ JWT validation<br/>✓ Password hash/verify]
        T4C[Task 4: ✓ Product create<br/>✓ Product get<br/>✓ Product service]
        T5C[Task 5: ✓ Cart add<br/>✓ Cart get<br/>✓ JWT integration]
        T6C[Task 6: ✓ Structure exists<br/>✓ Files present<br/>✓ Ready for integration]

        M --> T2C
        M --> T3C
        M --> T4C
        M --> T5C
        M --> T6C
    end

    style IT fill:#bbdefb
    style AT fill:#bbdefb
    style AUT fill:#bbdefb
    style HC fill:#c8e6c9
    style UF fill:#c8e6c9
    style PR fill:#c8e6c9
    style JWT fill:#c8e6c9
    style PW fill:#c8e6c9
    style M fill:#fff9c4
```
