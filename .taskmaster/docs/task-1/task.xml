<?xml version="1.0" encoding="UTF-8"?>
<prompt>
    <role>You are a senior Rust backend developer specializing in database schema design with Diesel ORM and PostgreSQL.</role>
    <task>
        <id>1</id>
        <title>Database Schema Setup</title>
        <description>Create basic database schema files and configuration for the Rust API project. Implement schema definitions using Diesel ORM for PostgreSQL, set up migration files, and configure database dependencies in Cargo.toml.</description>
        <priority>high</priority>
        <status>pending</status>
        <dependencies></dependencies>
        <level>0</level>
        <estimated_time>30 minutes</estimated_time>
    </task>
    <technical_specifications>
        <spec>Use Diesel 2.1.0 ORM with PostgreSQL and r2d2 connection pooling features</spec>
        <spec>Define four core tables: users, products, carts, and cart_items</spec>
        <spec>Use appropriate SQL data types: Integer, Varchar, Text, Numeric, Timestamp</spec>
        <spec>Create migration files following Diesel conventions for schema management</spec>
        <spec>Include dotenv dependency for environment variable configuration</spec>
    </technical_specifications>
    <implementation_details>
        <step>
            <number>1</number>
            <action>Create src/schema.rs file</action>
            <details>
                Create a new file at src/schema.rs with Diesel table definitions:

                - users table with columns: id (Integer, PK), username (Varchar), email (Varchar), password_hash (Varchar), created_at (Timestamp)
                - products table with columns: id (Integer, PK), name (Varchar), description (Text), price (Numeric), inventory_count (Integer)
                - carts table with columns: id (Integer, PK), user_id (Integer, FK), created_at (Timestamp)
                - cart_items table with columns: id (Integer, PK), cart_id (Integer, FK), product_id (Integer, FK), quantity (Integer)

                Use Diesel's table! macro for all definitions to ensure type safety and compile-time query verification.
            </details>
        </step>
        <step>
            <number>2</number>
            <action>Create migrations directory structure</action>
            <details>
                Create migrations/ directory in project root and add initial migration:

                - Create migrations/ directory
                - Add subdirectory with timestamp-based name (e.g., 00000000000000_create_tables)
                - Create up.sql with CREATE TABLE statements for all four tables
                - Optionally create down.sql with DROP TABLE statements for rollback capability

                Ensure migration files follow Diesel's conventions for compatibility with diesel CLI tools.
            </details>
        </step>
        <step>
            <number>3</number>
            <action>Update Cargo.toml dependencies</action>
            <details>
                Add database-related dependencies to Cargo.toml [dependencies] section:

                diesel = { version = "2.1.0", features = ["postgres", "r2d2"] }
                r2d2 = "0.8.10"
                dotenv = "0.15.0"

                These dependencies provide: Diesel ORM with PostgreSQL support, r2d2 connection pooling, and dotenv for configuration management.
            </details>
        </step>
        <step>
            <number>4</number>
            <action>Validate implementation</action>
            <details>
                Run validation checks:

                - Execute 'cargo check' to verify syntax correctness
                - Confirm src/schema.rs compiles without errors
                - Verify migrations directory structure is correct
                - Check that all dependencies resolve properly

                Do not proceed to marking complete if any validation fails.
            </details>
        </step>
    </implementation_details>
    <acceptance_criteria>
        <criterion>src/schema.rs file exists and contains definitions for users, products, carts, and cart_items tables using Diesel's table! macro</criterion>
        <criterion>migrations/ directory exists with proper structure and at least one migration with up.sql file</criterion>
        <criterion>Cargo.toml includes diesel (v2.1.0 with postgres and r2d2 features), r2d2 (v0.8.10), and dotenv (v0.15.0) dependencies</criterion>
        <criterion>Schema definitions use correct data types: Integer for IDs and counts, Varchar for short strings, Text for long strings, Numeric for prices, Timestamp for dates</criterion>
        <criterion>Code passes 'cargo check' without compilation errors or warnings</criterion>
        <criterion>Migration files follow Diesel naming conventions and can be parsed by diesel CLI</criterion>
        <criterion>All files are properly formatted and follow Rust coding standards</criterion>
    </acceptance_criteria>
    <test_strategy>
        Validation approach for this schema-only task:

        1. Compilation Testing:
           - Run 'cargo check' to verify syntax
           - Ensure no compilation errors in schema definitions
           - Verify dependencies resolve correctly

        2. File Structure Verification:
           - Confirm src/schema.rs exists with all 4 table definitions
           - Verify migrations/ directory structure
           - Check Cargo.toml has all required dependencies

        3. Schema Validation:
           - Verify table! macro usage is correct
           - Check column names and types match requirements
           - Ensure primary keys are properly defined

        4. Integration Readiness:
           - Schema is importable via 'use crate::schema::*;'
           - Table definitions are accessible to other modules
           - Ready for use by Task 2 (API Endpoints)

        5. Commands to execute:
           cargo check
           ls -la src/schema.rs
           ls -la migrations/
           grep -E "diesel|r2d2|dotenv" Cargo.toml
    </test_strategy>
    <instructions>
        You are implementing Task 1: Database Schema Setup for a parallel task execution test project.

        CRITICAL INSTRUCTIONS:
        - This is a Level 0 task with NO dependencies - proceed immediately
        - Create exactly the files specified: src/schema.rs, migrations/, and update Cargo.toml
        - Use the exact table structures and dependencies provided
        - This is a test project - keep implementation simple and focused
        - File conflicts with Task 2 on Cargo.toml are expected and acceptable

        IMPLEMENTATION APPROACH:
        1. Think step-by-step through each file creation
        2. Use Diesel's table! macro exactly as shown in the specifications
        3. Follow Rust and Diesel conventions for naming and structure
        4. Include proper error handling in migration files
        5. Validate with 'cargo check' before completing

        QUALITY STANDARDS:
        - All schema definitions must be syntactically correct
        - Use appropriate SQL data types for each column
        - Follow Diesel ORM best practices
        - Ensure migration files are properly structured
        - Keep code clean and well-organized

        INTEGRATION POINTS:
        - Task 2 (API Endpoints) depends on this schema
        - Task 3 (Auth) will use users table
        - Task 4 (Catalog) will use products table
        - Task 5 (Cart) will use carts and cart_items tables

        SUCCESS DEFINITION:
        You have completed this task successfully when:
        1. All required files are created with correct content
        2. 'cargo check' passes without errors
        3. Schema is ready for use by dependent tasks
        4. Code follows Rust and Diesel conventions

        DO NOT add extra features, additional tables, or unnecessary complexity.
        DO NOT skip validation steps.
        DO mark the task complete only after all acceptance criteria are met.
    </instructions>
</prompt>
