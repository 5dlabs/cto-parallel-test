sequenceDiagram
    participant User
    participant AuthModule
    participant JWT
    participant Argon2

    Note over User,Argon2: JWT Token Creation Flow
    User->>AuthModule: create_token("user_123")
    AuthModule->>JWT: Prepare claims (sub, exp, iat)
    Note right of JWT: exp = now + 24 hours<br/>iat = now
    JWT->>JWT: Encode with HS256 + secret
    JWT-->>AuthModule: JWT token string
    AuthModule-->>User: Result&lt;String&gt;

    Note over User,Argon2: JWT Token Validation Flow
    User->>AuthModule: validate_token(token)
    AuthModule->>JWT: Decode with secret
    JWT->>JWT: Verify signature
    JWT->>JWT: Check expiration
    JWT-->>AuthModule: Claims {sub, exp, iat}
    AuthModule-->>User: Result&lt;Claims&gt;

    Note over User,Argon2: Password Hashing Flow
    User->>AuthModule: hash_password("password123")
    AuthModule->>Argon2: Generate 32-byte salt
    Argon2->>Argon2: Apply Argon2 algorithm
    Note right of Argon2: Memory-hard<br/>Side-channel resistant
    Argon2-->>AuthModule: Encoded hash string
    AuthModule-->>User: Hash result

    Note over User,Argon2: Password Verification Flow
    User->>AuthModule: verify_password("password123")
    AuthModule->>Argon2: verify_encoded(hash, password)
    Argon2->>Argon2: Constant-time comparison
    Argon2-->>AuthModule: bool (match result)
    AuthModule-->>User: true/false

---

graph TB
    subgraph "Authentication Module Structure"
        ModRS[auth/mod.rs<br/>Module Exports]
        JWT[auth/jwt.rs<br/>Token Management]
        Models[auth/models.rs<br/>User & Password]
    end

    subgraph "JWT Components"
        CreateToken[create_token<br/>User ID → Token]
        ValidateToken[validate_token<br/>Token → Claims]
        Claims[Claims Struct<br/>sub, exp, iat]
    end

    subgraph "User & Password"
        UserStruct[User Struct<br/>id, username, email, password_hash]
        HashPassword[hash_password<br/>Password → Argon2 Hash]
        VerifyPassword[verify_password<br/>Password + Hash → bool]
    end

    subgraph "Security Features"
        Argon2Algo[Argon2<br/>Memory-Hard Hashing]
        RandomSalt[32-byte Random Salt<br/>Unique per Password]
        ConstantTime[Constant-Time Comparison<br/>No Timing Attacks]
        NoSerialize[#[serde skip_serializing]<br/>Password Never in JSON]
    end

    ModRS --> JWT
    ModRS --> Models
    JWT --> CreateToken
    JWT --> ValidateToken
    JWT --> Claims
    Models --> UserStruct
    Models --> HashPassword
    Models --> VerifyPassword
    HashPassword --> Argon2Algo
    HashPassword --> RandomSalt
    VerifyPassword --> ConstantTime
    UserStruct --> NoSerialize

    style CreateToken fill:#90EE90
    style ValidateToken fill:#90EE90
    style HashPassword fill:#90EE90
    style VerifyPassword fill:#90EE90
    style Argon2Algo fill:#FFB6C1
    style RandomSalt fill:#FFB6C1
    style ConstantTime fill:#FFB6C1
    style NoSerialize fill:#FFB6C1

    classDef security fill:#FFB6C1
    classDef function fill:#90EE90
